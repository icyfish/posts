<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="IDYUPnBNhdnU8o9LRNKZ1RSt14tIxTI0rLeMrBtswXw"><title> 移动设备300毫秒延迟问题 · Fish</title><meta name="description" content="移动设备300毫秒延迟问题 - Fish"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/posts/favicon.png"><link rel="stylesheet" href="/posts/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://icyfish.github.io/posts/atom.xml" title="Fish"><meta name="generator" content="Hexo 7.0.0-rc1"></head><body><div class="wrap"><header><a href="/posts/" class="logo-link"><img src="/posts/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/posts/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/posts/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/posts/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="http://twitter.com/icyfish_" target="_blank" class="nav-list-link">TWITTER</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">移动设备300毫秒延迟问题</h1><div class="post-info">Aug 11, 2017</div><div class="post-content"><p>过去, 移动端浏览器对于<code>touchend</code>和<code>click</code>事件添加了300-350毫秒的延迟, 以检测用户是否要执行两次点击.</p>
<a id="more"></a>
<h2 id="移除300毫秒延迟"><a href="#移除300毫秒延迟" class="headerlink" title="移除300毫秒延迟"></a>移除300毫秒延迟</h2><p>从安卓设备第一个版本的Chrome开始, 如果用户禁用捏合双指缩放, 该延迟就不会生效. 然而捏合双指缩放是个重要的辅助特性. 在Chrome 32(2014年的版本)中, 为了使站点在移动端有更好的体验, 浏览器添加了移除300毫秒延迟的功能, 不过捏合双指缩放依然可用. Firefox和IE/Edge很快在这之后也做出了同样的实现, safari则在2016年3月的ios9.3中实现.</p>
<p>这样的改变对用户体验来说是极大的提升, 关于用户动作响应时间与web性能的关系详见: <a href="https://developers.google.com/web/fundamentals/performance/rail" target="_blank" rel="noopener">introduction to RAIL</a></p>
<p>想要移除300-350毫秒延迟, 只需在HTML的<code>&lt;head&gt;</code>标签中添加以下标签:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上标签将视窗宽度设置为与设备宽度相同, 对于移动端优化的站点, 是最佳实践. 如果添加了这部分标签, 在移动设备上, 浏览器会优化文本的可读性, 也不再需要捏合双指缩放, 此时点击就不会有延迟. </p>
<p>如果无法添加上述标签, 可以使用<code>touch-action: manipulation</code>达到上述效果, 可以在整个页面添加, 也可以在某个元素上添加. </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">touch-action</span>: manipulation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过Firefox不支持<code>touch-action: manipulation</code>, 因此添加<code>&lt;meta&gt;</code>标签是更好的方式. </p>
<h2 id="无法执行捏合双指缩放是否对可用性造成影响"><a href="#无法执行捏合双指缩放是否对可用性造成影响" class="headerlink" title="无法执行捏合双指缩放是否对可用性造成影响"></a>无法执行捏合双指缩放是否对可用性造成影响</h2><p>并不会, 捏合双指缩放依然可用, 操作系统会提供相类似的功能. 在安卓设备上, 可以使用<a href="https://support.google.com/accessibility/android/answer/6006949" target="_blank" rel="noopener">Magnification gestures</a>(放大手势).</p>
<h2 id="适配旧版浏览器"><a href="#适配旧版浏览器" class="headerlink" title="适配旧版浏览器"></a>适配旧版浏览器</h2><p><a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener">FT Labs的FastClick库</a>捕捉<code>touch</code>事件, 就不会延迟触发, 同时还移除了两次点击手势. 该库通过对比触发<code>touchstart</code>事件时屏幕上的手指个数以及触发<code>touchend</code>事件时屏幕上的手指个数以区分滑动和点击.</p>
<p>不过添加<code>touchstart</code>事件处理器会对性能有所影响, 类似滑动等底层的交互会因调用该事件处理器被延迟, 因为要检查事件默认行为是否被禁用(<code>event.preventDefault()</code>). 不过FastClick库内部做了一些实现, 在浏览器没有300毫秒延迟时, 不会添加<code>touch</code>事件处理器.</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://developers.google.com/web/updates/2013/12/300ms-tap-delay-gone-away" target="_blank" rel="noopener">300ms tap delay, gone away</a></li>
<li><a href="https://github.com/ftlabs/fastclick" target="_blank" rel="noopener">Fastclick</a></li>
<li><a href="https://github.com/ftlabs/fastclick/issues/514" target="_blank" rel="noopener">ios延迟</a></li>
<li><a href="https://stackoverflow.com/questions/27173272/300ms-delay-removal-using-fastclick-js-vs-using-ontouchstart" target="_blank" rel="noopener">Stackoverflow - fastclickjs</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/posts/2017/08/24/module-pattern/" class="prev">PREV</a><a href="/posts/2017/08/11/CORS/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2023 <a href="https://icyfish.github.io/posts">Fish</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="IDYUPnBNhdnU8o9LRNKZ1RSt14tIxTI0rLeMrBtswXw"><title> React å¦‚ä½•åŒºåˆ†ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶? Â· Fish</title><meta name="description" content="React å¦‚ä½•åŒºåˆ†ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶? - Fish"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/posts/favicon.png"><link rel="stylesheet" href="/posts/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://icyfish.github.io/posts/atom.xml" title="Fish"><meta name="generator" content="Hexo 7.0.0-rc1"></head><body><div class="wrap"><header><a href="/posts/" class="logo-link"><img src="/posts/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/posts/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/posts/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/posts/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="http://twitter.com/icyfish_" target="_blank" class="nav-list-link">TWITTER</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">React å¦‚ä½•åŒºåˆ†ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶?</h1><div class="post-info">Jan 15, 2020</div><div class="post-content"><p>åŸæ–‡: <a href="https://overreacted.io/how-does-react-tell-a-class-from-a-function/" target="_blank" rel="noopener">How Does React Tell a Class from a Function?</a></p>
<p>ä¸‹é¢è¿™ä¸ª <code>Greeting</code> æ˜¯ä¸€ä¸ªå‡½æ•°å¼ React ç»„ä»¶:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>React åŒæ ·æ”¯æŒä»¥ç±»çš„å½¢å¼å®šä¹‰ä¸€ä¸ªç»„ä»¶:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(å‡½æ•°å¼ç»„ä»¶å¯ä»¥é€šè¿‡ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">hooks</a> ä¿å­˜çŠ¶æ€)</p>
<p>ä¸è¿‡å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™, æˆ‘ä»¬å¹¶ä¸åœ¨æ„å®ƒæ˜¯å¦‚ä½•å®šä¹‰çš„:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Class or function â€” whatever.</span></span><br><span class="line">&lt;Greeting /&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ React æœ¬èº«å¯¹ç»„ä»¶æ˜¯å‡½æ•°å¼è¿˜æ˜¯ç±»å¼, ååˆ†åœ¨æ„.</p>
<p>å¦‚æœ <code>Greeting</code> æ˜¯å‡½æ•°å¼ç»„ä»¶, React çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯è°ƒç”¨å®ƒ:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="keyword">const</span> result = Greeting(props); <span class="comment">// &lt;p&gt;Hello&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœ <code>Greeting</code> æ˜¯ç±»å¼ç»„ä»¶, React çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯ä½¿ç”¨ <code>new</code> æ“ä½œç¬¦æ¥å®ä¾‹åŒ–è¿™ä¸ªç»„ä»¶, å¹¶è°ƒç”¨æ‰€åˆ›å»ºå®ä¾‹çš„ <code>render</code> æ–¹æ³•.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Your code</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">new</span> Greeting(props); <span class="comment">// Greeting &#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> result = instance.render(); <span class="comment">// &lt;p&gt;Hello&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸‹, React çš„ç›®æ ‡éƒ½æ˜¯è·å–éœ€è¦è¢«æ¸²æŸ“çš„ DOM èŠ‚ç‚¹(åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ <code>&lt;p&gt;Hello&lt;/p&gt;</code> ). å…·ä½“çš„è·å–æ­¥éª¤, è¿˜æ˜¯æ ¹æ® <code>Greeting</code> å¦‚ä½•è¢«å®šä¹‰æ¥å†³å®š.</p>
<p><strong>é‚£ä¹ˆ React æ˜¯å¦‚ä½•çŸ¥é“ç»„ä»¶æ˜¯ç±»è¿˜æ˜¯å‡½æ•°çš„å‘¢?</strong></p>
<p>å°±åƒæˆ‘åœ¨<a href="https://overreacted.io/why-do-we-write-super-props/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ä¸­è¯´çš„, å³ä½¿ä¸çŸ¥é“è¿™ç‚¹, <strong>ä½ ä¹Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°ç”¨ React æ„å»ºå‡º web åº”ç”¨.</strong> æˆ‘ä¹Ÿå¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±äº†è§£è¿™ä¸ªçŸ¥è¯†çš„, å› æ­¤è¯·ä¸è¦å°†è¿™ä¸ªçŸ¥è¯†ç‚¹ä½œä¸ºé¢è¯•é¢˜è¯¢é—®æ±‚èŒè€…. å®é™…ä¸Š, è¿™ç¯‡æ–‡ç« æ‰€æ¶‰åŠçš„çŸ¥è¯†æ›´åå‘äº JavaScript è€Œä¸æ˜¯ React.</p>
<p>è¿™ç¯‡æ–‡ç« çš„ç›®æ ‡è¯»è€…æ˜¯å¯¹ React çš„åº•å±‚åŸç†æœ‰å¥½å¥‡å¿ƒçš„å¼€å‘è€…, å¦‚æœä½ æ˜¯çš„è¯, é‚£ä¹ˆå°±è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å§.</p>
<p><strong>æˆ‘ä»¬çš„æ¢ç´¢æ—…ç¨‹ä¼šå¾ˆé•¿. è¯·ç³»å¥½å®‰å…¨å¸¦. æœ¬æ–‡æ¶‰åŠåˆ°çš„ React çŸ¥è¯†ç‚¹å…¶å®å¹¶ä¸å¤š, æ›´å¤šçš„æ˜¯å…³äº JavaScript çš„çŸ¥è¯†ç‚¹, æ¯”å¦‚è¯´: <code>new</code> , <code>this</code> , <code>class</code> , ç®­å¤´å‡½æ•°, <code>prototype</code> , <code>__proto__</code>, <code>instanceof</code> ç­‰. å¹¸è¿çš„æ˜¯, å½“ä½ åœ¨ä½¿ç”¨ React çš„æ—¶å€™, å¹¶ä¸éœ€è¦ç‰¹åˆ«è€ƒè™‘è¿™äº›. ä¸è¿‡ç«™åœ¨ React çš„å¼€å‘è€…è§’åº¦, æƒ…å†µå°±ä¸ä¸€æ ·äº†â€¦â€¦</strong></p>
<p>(å¦‚æœä½ ä¸å¸Œæœ›äº†è§£å®ç°ç»†èŠ‚, åªæƒ³è¦çŸ¥é“ç­”æ¡ˆ, è¯·ç›´æ¥æŸ¥çœ‹æ–‡æœ«çš„å†…å®¹.)</p>
<hr>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç†è§£, ä¸ºä»€ä¹ˆåŒºåˆ«å¯¹å¾…å‡½æ•°å¼ç»„ä»¶å’Œç±»ç»„ä»¶æ˜¯é‡è¦çš„. å½“æˆ‘ä»¬è°ƒç”¨ç±»ç»„ä»¶æ—¶å€™, éœ€è¦ä¾èµ– <code>new</code> æ“ä½œç¬¦:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœ Greeting æ˜¯å‡½æ•°å¼ç»„ä»¶, åœ¨reactå†…éƒ¨ä¼šè¢«è¿™æ ·è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> result = Greeting(props); <span class="comment">// &lt;p&gt;Hello&lt;/p&gt;</span></span><br><span class="line"><span class="comment">// å¦‚æœ Greeting æ˜¯ class ç»„ä»¶, åœ¨reactå†…éƒ¨ä¼šè¢«è¿™æ ·è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">new</span> Greeting(props); <span class="comment">// Greeting &#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> result = instance.render(); <span class="comment">// &lt;p&gt;Hello&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€ä¸‹, <code>new</code> æ“ä½œç¬¦åœ¨ JavaScript ä¸­å…·ä½“åšäº†äº›ä»€ä¹ˆ.</p>
<hr>
<p>è¿‡å» JavaScript ä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µ. ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªä¸ç±»æœ‰ç±»ä¼¼åŠŸèƒ½çš„å‡½æ•°. å…·ä½“è§ä¸‹é¢çš„ä¾‹å­, é’ˆå¯¹è¿™ç§ç‰¹æ®Šçš„å‡½æ•°, æˆ‘ä»¬ä½¿ç”¨ <code>new</code>å…³é”®å­—è¿›è¡Œè°ƒç”¨.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>); <span class="comment">// âœ… Person &#123;name: 'Fred'&#125;</span></span><br><span class="line"><span class="keyword">var</span> george = Person(<span class="string">'George'</span>); <span class="comment">// ğŸ”´ ä¸ä¼šèµ·ä½œç”¨, </span></span><br><span class="line"><span class="comment">// å¦‚æœå°†ä»£ç åœ¨æ§åˆ¶å°æ‰§è¡Œ, ä¼šå‘ç° this æŒ‡å‘å…¨å±€ window.name æ˜¯ George</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬è°ƒç”¨ <code>Person(&#39;Fred&#39;)</code> æ—¶æ²¡æœ‰åŠ ä¸Š <code>new</code> å…³é”®å­—, å‡½æ•°ä¸­çš„ <code>this</code> ä¼šæŒ‡å‘å…¨å±€, é‚£ä¹ˆè¿™ä¸ª <code>this</code> å°±ä¸€ç‚¹æ„ä¹‰ä¹Ÿæ²¡æœ‰äº†. æˆ‘ä»¬çš„ä»£ç ä¼šå´©æºƒ, åŒæ—¶è¿˜åšäº†ä»¶è ¢äº‹: åˆ›å»ºäº†ä¸€ä¸ªæ— ç”¨çš„å…¨å±€å˜é‡.</p>
<p><strong>é‚£ä¹ˆä½¿ç”¨ <code>new</code> è°ƒç”¨å‡½æ•°æ—¶å…·ä½“å‘ç”Ÿäº†äº›ä»€ä¹ˆå‘¢?</strong></p>
<p>åœ¨è°ƒç”¨å‡½æ•°æ—¶æ·»åŠ <code>new</code>, ç›¸å½“äºå‘Šè¯‰ JavaScript, <code>Person</code>è™½ç„¶åªæ˜¯ä¸ªå‡½æ•°, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹åšç±»æ„é€ å™¨. <strong>æ­¤æ—¶ JavaScript å°±ä¼šåˆ›å»ºä¸€ä¸ª<code>{}</code>å¯¹è±¡, ç„¶å<code>Person</code>ä¸­çš„<code>this</code>å€¼æŒ‡å‘è¯¥å¯¹è±¡, åŒæ—¶å°† <code>name</code> è®¾ç½®ä¸ºè¯¥å¯¹è±¡çš„å±æ€§, å¹¶ä¸” <code>return</code> å‡ºè¯¥å¯¹è±¡.</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>); <span class="comment">// Same object as `this` inside `Person`</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šçš„ <code>new</code> è°ƒç”¨, å¯¹è±¡ <code>fred</code> è¿˜å¯ä»¥è¯»å–æ„é€ å™¨å‡½æ•° <code>Person.prototype</code> ä¸Šçš„å±æ€§.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hi, I am '</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>);</span><br><span class="line">fred.sayHi();</span><br></pre></td></tr></table></figure>
<p>åœ¨ JavaScript ä¸åŸç”Ÿæ”¯æŒ<code>class</code>ä¹‹å‰, å¼€å‘è€…å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¨¡æ‹Ÿç±»çš„.</p>
<hr>
<p><code>new</code> å…³é”®å­—å­˜åœ¨å·²ä¹…, è€Œ <code>class</code> çš„æ”¯æŒå´æ˜¯è¿‘æ®µæ—¶é—´çš„äº‹. ç°åœ¨æˆ‘ä»¬ä½¿ç”¨<code>class</code>æ”¹å†™å…ˆå‰çš„ä»£ç .</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  sayHi() &#123;</span><br><span class="line">    alert(<span class="string">'Hi, I am '</span> + <span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>);</span><br><span class="line">fred.sayHi();</span><br></pre></td></tr></table></figure>
<p>åœ¨è®¾è®¡ç¼–ç¨‹è¯­è¨€å’Œ API æ—¶, ç”¨æˆ·çš„ç—›ç‚¹è‡³å…³é‡è¦.</p>
<p>å¼€å‘è€…åœ¨ç¼–å†™å‡½æ•°æ—¶, JavaScript æ— æ³•çŒœæµ‹åˆ°å‡½æ•°æ˜¯éœ€è¦è¢«ç›´æ¥è°ƒç”¨è¿˜æ˜¯åœ¨ä¹‹å‰åŠ å…³é”®è¯ <code>new</code> è°ƒç”¨.  å› æ­¤å¼€å‘è€…åœ¨è°ƒç”¨ç±»ä¼¼ <code>Person</code> è¿™æ ·çš„æ„é€ å‡½æ•°æ—¶, åŠ¡å¿…è®°å¾—åœ¨å‰é¢æ·»åŠ  <code>new</code> å…³é”®å­—, å¦åˆ™å°±ä¼šç»™ç¨‹åºå¼•å…¥ä¸€äº›ä»¤äººç–‘æƒ‘çš„é—®é¢˜.</p>
<p><strong>æœ‰äº† Class è¯­æ³•ä¹‹å, æˆ‘ä»¬çš„è¯­å¢ƒä¸­å°±æœ‰äº†ç±»çš„æ¦‚å¿µ, å¯¹äºè¿™ç±»ç‰¹æ®Šçš„å‡½æ•°, æˆ‘ä»¬å°±èƒ½è¯´, å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‡½æ•°, è€Œæ˜¯ä¸€ä¸ªç±», åŒæ—¶æœ‰è‡ªå·±çš„æ„é€ å‡½æ•°.</strong> å¦‚æœä½ åœ¨è°ƒç”¨å®ƒçš„æ—¶å€™å¿˜äº†åŠ ä¸Š <code>new</code> å…³é”®å­—, JavaScript å°±ä¼šæŠ›å‡ºé”™è¯¯.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>);</span><br><span class="line"><span class="comment">// âœ…  If Person is a function: works fine</span></span><br><span class="line"><span class="comment">// âœ…  If Person is a class: works fine too</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> george = Person(<span class="string">'George'</span>); <span class="comment">// We forgot `new`</span></span><br><span class="line"><span class="comment">// ğŸ˜³ If Person is a constructor-like function: confusing behavior</span></span><br><span class="line"><span class="comment">// ğŸ”´ If Person is a class: fails immediately</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥, æˆ‘ä»¬å°±é¿å…å†™å‡ºé€ æˆè®¸å¤šéšè—bugçš„ä»£ç , æ¯”å¦‚ <code>this.name</code> è¢«å½“ä½œæ˜¯ <code>window.name</code> è€Œä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„ <code>george.name</code> .</p>
<p>ä¸è¿‡å¦‚æœ React ä¹Ÿå¿…é¡»éµå¾ªè¿™ä¸ªåŸåˆ™çš„è¯, é‚£ä¹ˆåœ¨è°ƒç”¨ä»»ä½•ç±»ç»„ä»¶çš„æ—¶å€™, å°±å¿…é¡»åœ¨ä¹‹å‰åŠ ä¸Š <code>new</code> å…³é”®å­—, å¦åˆ™çš„è¯ JavaScript å°±ä¼šæŠ›å‡ºå¼‚å¸¸.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">	render() &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´ React æ— æ³•è¿™æ ·åš</span></span><br><span class="line"><span class="keyword">const</span> instance = Counter(props);</span><br></pre></td></tr></table></figure>
<hr>
<p>é‚£ä¹ˆ React æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢? å¤§å¤šæ•°å¼€å‘è€…åœ¨ä½¿ç”¨Reactæ—¶ä¼šåŒæ—¶ä½¿ç”¨<code>Babel</code> æ¥ç¼–è¯‘æœ€æ–°è¯­æ³•çš„ä»£ç ä»¥å…¼å®¹æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨. å› æ­¤æˆ‘ä»¬æŠŠè§£å†³æ–¹æ¡ˆçš„å¤´ç»ªæ”¾åœ¨äº†ç¼–è¯‘å™¨ä¸Š.</p>
<p>åœ¨å‰å‡ ä¸ªç‰ˆæœ¬çš„ <code>Babel</code> ä¸­, ç±»å¯ä»¥ä¸éœ€è¦å£°æ˜ <code>new</code> å…³é”®å­—ç›´æ¥è°ƒç”¨, ä½†æ˜¯è¿™ä¸ªé—®é¢˜å¾ˆå¿«è¢« <code>Babel</code> å›¢é˜Ÿä¿®å¤äº†, æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»–ä»¬çš„ä¿®å¤æ–¹å¼:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// A bit simplified from Babel output:</span></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Person)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Our code:</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Person(<span class="string">'Fred'</span>); <span class="comment">// âœ… Okay</span></span><br><span class="line">Person(<span class="string">'George'</span>);   <span class="comment">// ğŸ”´ Cannot call a class as a function</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ çœ‹è¿‡é¡¹ç›®æ‰“åŒ…ä¹‹åçš„ä»£ç çš„è¯, å¯èƒ½ä¼šè§‰å¾—è¿™ä¸ªå‡½æ•°ä¼¼æ›¾ç›¸è¯†, è¿™ä¸ªå°±æ˜¯<code>_classCallCheck</code> å‡½æ•°æ‰€åšçš„äº‹æƒ…. (ä½ å¯ä»¥é€šè¿‡å¼€å¯â€å®½æ¾æ£€æŸ¥æ¨¡å¼â€æ¥å‡å°‘æ‰“åŒ…ä¹‹åä»£ç çš„é‡, ä½†æ˜¯è¿™å½“ç„¶ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜: å½“å¤„ç†çœŸæ­£çš„åŸç”Ÿç±»è¯­æ³•æ—¶, æƒ…å†µä¼šå˜å¾—æ›´åŠ å¤æ‚. You can reduce the bundle size by opting into the â€œloose modeâ€ with no checks but this might complicate your eventual transition to real native classes.)</p>
<hr>
<p>è‡³æ­¤, æˆ‘ä»¬æ˜ç™½äº†è°ƒç”¨å‡½æ•°æ—¶åŠ  <code>new</code> ä¸ä¸åŠ  <code>new</code> çš„åŒºåˆ«:</p>
<p><img src="/posts/images/compare.png" alt="compare"></p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ, åœ¨Reactä¸­, æ­£ç¡®è°ƒç”¨ç»„ä»¶æ˜¯å¤šä¹ˆé‡è¦. <strong>å¦‚æœç»„ä»¶è¢«å®šä¹‰ä¸ºç±»ç»„ä»¶, Reactå¿…é¡»åœ¨å‰æ·»åŠ  <code>new</code> å…³é”®å­—è¿›è¡Œè°ƒç”¨.</strong></p>
<p>é‚£ä¹ˆ React æ˜¯å¦å¯ä»¥ä¸ä¾èµ–ä»»ä½•å…¶ä»–ä¿¡æ¯åŒºåˆ†å‡ºç»„ä»¶æ˜¯å‡½æ•°å¼ç»„ä»¶è¿˜æ˜¯classç»„ä»¶å‘¢?</p>
<p>å¹¶ä¸ç®€å•. è™½ç„¶æˆ‘ä»¬<a href="https://stackoverflow.com/questions/29093396/how-do-you-check-the-difference-between-an-ecmascript-6-class-and-function" target="_blank" rel="noopener">åœ¨ JavaScript ä¸­å¯ä»¥åŒºåˆ†å‡º class å‡½æ•°å’Œæ™®é€šå‡½æ•°</a>, ä½†æ˜¯è¢« <code>Babel</code> å¤„ç†è¿‡çš„ä»£ç , å°±å¾ˆéš¾åŒºåˆ†äº†. å› ä¸ºç»è¿‡å¤„ç†ä¹‹å, å¯¹äºæµè§ˆå™¨æ¥è¯´, å®ƒä»¬éƒ½æ˜¯æ™®é€šçš„å‡½æ•°. ä¸è¿‡åœ¨ React ä¸­, æˆ‘ä»¬è¿˜æ˜¯æœ‰åŠæ³•å¤„ç†çš„.</p>
<hr>
<p>æˆ–è®¸ React å¯ä»¥é’ˆå¯¹æ¯ä¸€æ¬¡è°ƒç”¨éƒ½åŠ ä¸Š <code>new</code> å…³é”®å­—? é—æ†¾çš„äº‹, è¿™æ ·çš„æ–¹å¼å¹¶ä¸é è°±. </p>
<p>è°ƒç”¨æ™®é€šå‡½æ•°æ—¶æ·»åŠ  <code>new</code> å…³é”®å­—ä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹. é’ˆå¯¹æ„é€ å™¨å‡½æ•°, ä½¿ç”¨ <code>new</code> è°ƒç”¨æ˜¯é¢„æœŸè¡Œä¸º, ä½†æ˜¯é’ˆå¯¹å‡½æ•°å¼ç»„ä»¶, è¿™ç§è°ƒç”¨æ–¹å¼å°±ä¼šè®©äººè§‰å¾—ç–‘æƒ‘.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// We wouldnâ€™t expect `this` to be any kind of instance here</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šè¿™ä¸ªåŸå› å¹¶æ²¡æœ‰åˆ°ä¸èƒ½æ¥å—çš„ç¨‹åº¦, ä½†æ˜¯è¿˜æœ‰å…¶ä»–ä¸¤ä¸ªé‡è¦åŸå› å†³å®šäº†ä¸å¯ä»¥å§‹ç»ˆæ·»åŠ  <code>new</code> å…³é”®è¯è¿›è¡Œå‡½æ•°è°ƒç”¨.</p>
<hr>
<p>ç¬¬ä¸€ä¸ªåŸå› æ˜¯ä½¿ç”¨ <code>new</code> è°ƒç”¨ç®­å¤´å‡½æ•°(æœªè¢« Babel ç¼–è¯‘è¿‡) ä¼šæŠ›å‡ºå¼‚å¸¸:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Greeting = <span class="function"><span class="params">()</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line"><span class="keyword">new</span> Greeting(); <span class="comment">// ğŸ”´ Greeting is not a constructor</span></span><br></pre></td></tr></table></figure>
<p>ç”±äºä¸ç¬¦åˆç®­å¤´å‡½æ•°çš„è®¾è®¡è¯­æ³•, JavaScript æœ‰æ„é™åˆ¶äº†è¿™ç§è¡Œä¸º. ç®­å¤´å‡½æ•°æœ€ä¸»è¦çš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯æ²¡æœ‰è‡ªå·±çš„ <code>this</code> , å¦‚æœåœ¨ç®­å¤´å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>this</code> çš„è¯, <code>this</code> çš„å€¼ä¼šç”±ç¦»å®ƒæœ€è¿‘çš„æ™®é€šå‡½æ•°å†³å®š.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Friends</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> friends = <span class="keyword">this</span>.props.friends;</span><br><span class="line">    <span class="keyword">return</span> friends.map(<span class="function"><span class="params">friend</span> =&gt;</span></span><br><span class="line">      &lt;Friend</span><br><span class="line">        <span class="comment">// `this` is resolved from the `render` method</span></span><br><span class="line">        size=&#123;<span class="keyword">this</span>.props.size&#125;</span><br><span class="line">        name=&#123;friend.name&#125;</span><br><span class="line">        key=&#123;friend.id&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>. å› æ­¤æˆ‘ä»¬æ²¡æœ‰åŠæ³•å°†ç®­å¤´å‡½æ•°æ”¹é€ ä¸ºæ„é€ å™¨å‡½æ•°.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Person = <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ This wouldnâ€™t make sense!</span></span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>JavaScript</strong> ç¦æ­¢äº†ä½¿ç”¨ <code>new</code> è°ƒç”¨ç®­å¤´å‡½æ•°çš„è¡Œä¸º. ä¹Ÿæ˜¯ç”±äºåŒæ ·çš„åŸå› , æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <code>new</code> å…³é”®è¯å®ä¾‹åŒ–ä¸€ä¸ªç±». </p>
<p>å› æ­¤, åœ¨Reactä¸­ç”¨ <code>new</code> è°ƒç”¨å‡½æ•°æ˜¯ä¸åˆç†çš„. é‚£ä¹ˆé’ˆå¯¹è¿™ç§æƒ…å†µ, æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ£€æµ‹å‡ºå‡½æ•°æ˜¯å¦ä¸ºç®­å¤´å‡½æ•°(å¦‚æœæ²¡æœ‰ <code>prototype</code> , åˆ™éç®­å¤´å‡½æ•°), ç„¶åé’ˆå¯¹å®ƒåšäº›ç‰¹æ®Šå¤„ç† (ä¸è¦ç”¨ <code>new</code> å»è°ƒç”¨å®ƒ).</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;).prototype; <span class="comment">// undefined</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;).prototype <span class="comment">// &#123;constructor: f&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å‡½æ•°ç»è¿‡Babelç¼–è¯‘ä¹‹å, å°±<a href="https://github.com/facebook/react/issues/4599#issuecomment-136562930" target="_blank" rel="noopener">ä¸èƒ½å¤Ÿç”¨ä»¥ä¸Šçš„æ–¹å¼åˆ¤æ–­</a>äº†. ç¼–è¯‘ä¹‹åçš„ç»“æœ:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).prototype;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).prototype;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡è¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¥½è§£å†³, å½±å“æ¯”è¾ƒä¸¥é‡çš„æ˜¯å¦ä¸€ä¸ªåŸå› :</p>
<hr>
<p>å½“å‡½æ•°çš„è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²æˆ–å…¶ä»–åŸå§‹ç±»å‹æ—¶, ä½¿ç”¨ <code>new</code> å¯¹å…¶è¿›è¡Œè°ƒç”¨ä¸ä¼šå¾—åˆ°æˆ‘ä»¬é¢„æœŸçš„ç»“æœ.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Greeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Hello'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Greeting(); <span class="comment">// âœ… 'Hello'</span></span><br><span class="line"><span class="keyword">new</span> Greeting(); <span class="comment">// ğŸ˜³ Greeting &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¡Œä¸ºå’Œ <code>new</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" target="_blank" rel="noopener">æ“ä½œç¬¦</a>æœ¬èº«çš„è®¾è®¡æœ‰å…³. åœ¨å‰æ–‡ä¸­æˆ‘ä»¬çŸ¥é“, <code>new</code> ä¼šå‘Šè¯‰ JavaScript å¼•æ“åˆ›å»ºä¸€ä¸ªå¯¹è±¡,  <code>this</code> æŒ‡å‘æ‰€åˆ›å»ºçš„å¯¹è±¡å®ä¾‹, ç„¶å <code>return</code> å‡ºè¯¥å®ä¾‹.</p>
<p>JavaScript  åŒæ ·å…è®¸å‡½æ•°è¢« <code>new</code> è°ƒç”¨æ—¶, é€šè¿‡æ§åˆ¶ <code>return</code> çš„å€¼æ¥è¦†ç›–é»˜è®¤è¿”å›çš„å¯¹è±¡.  å½“åœ¨å¯¹è±¡æ± æ¨¡å¼ä¸‹, æƒ³è¦å¤ç”¨å‡½æ•°å®ä¾‹æ—¶, è¿™ç§æ¨¡å¼å°±å¯ä»¥å‘æŒ¥ä½œç”¨äº†. </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Created lazily</span></span><br><span class="line"><span class="keyword">var</span> zeroVector = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x === <span class="number">0</span> &amp;&amp; y === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (zeroVector !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// Reuse the same instance</span></span><br><span class="line">      <span class="keyword">return</span> zeroVector;</span><br><span class="line">    &#125;</span><br><span class="line">    zeroVector = <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.x = x;</span><br><span class="line">  <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Vector(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Vector(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">// ğŸ˜² b === c</span></span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯, å½“æ‰‹åŠ¨ <code>return</code> å‡ºçš„ä¸æ˜¯å¯¹è±¡, è€Œæ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ç±»å‹, è¿™äº›å€¼å°±æ— æ³•è¦†ç›–é»˜è®¤çš„å¯¹è±¡.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Answer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Answer(); <span class="comment">// âœ… 42</span></span><br><span class="line"><span class="keyword">new</span> Answer(); <span class="comment">// ğŸ˜³ Answer &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤, å¦‚æœå§‹ç»ˆç”¨ <code>new</code> è°ƒç”¨å‡½æ•°, <code>React</code> å°±æ°¸è¿œæ— æ³•æ”¯æŒè¿”å›å€¼ä¸ºæ•°å­—æˆ–è€…å­—ç¬¦ä¸²çš„ç»„ä»¶äº†.</p>
<p>ç”±äºè¿™ä¸ªåŸå› , æˆ‘ä»¬å¿…é¡»åšå‡ºä¸€äº›å¦¥å.</p>
<hr>
<p>è‡³æ­¤æˆ‘ä»¬å­¦åˆ°äº†: React é’ˆå¯¹ç±»ç»„ä»¶è°ƒç”¨æ—¶(åŒ…æ‹¬ç»è¿‡ Babel å¤„ç†çš„ç»“æœ), éœ€è¦æ·»åŠ  <code>new</code> å…³é”®å­—, ä½†æ˜¯æ™®é€šå‡½æ•°å’Œç®­å¤´å‡½æ•°è°ƒç”¨å´ä¸éœ€è¦. å¯æ˜¯åˆ°ç›®å‰ä¸ºæ­¢å¹¶æ²¡æœ‰å¯é çš„æ–¹æ³•å¯¹è¿™ä¸¤ç§æ–¹å¼è¿›è¡ŒåŒºåˆ†.</p>
<p><strong>ä¸è¿‡æˆ‘ä»¬æ˜¯å¦å¯ä»¥è½¬æ¢çœ‹é—®é¢˜çš„è§’åº¦, é’ˆå¯¹é€šç”¨çš„é—®é¢˜æˆ‘ä»¬æ²¡æœ‰åŠæ³•è§£å†³, é‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ›´å…·ä½“çš„é—®é¢˜å»è§£å†³. If we canâ€™t solve a general problem, can we solve a more specific one?</strong> </p>
<p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª React ç±»ç»„ä»¶æ—¶, è¯¥ç»„ä»¶ä¸€å®šä¼šç»§æ‰¿ <code>React.Component</code> ä»¥ä¾¿ä½¿ç”¨ React çš„å†…éƒ¨æ–¹æ³• <code>this.setState()</code> .  <strong>è¿™æ ·çš„è¯, æˆ‘ä»¬æ˜¯å¦å°±ä¸éœ€è¦æ£€æµ‹æ‰€æœ‰çš„ç±», åªéœ€è¦æ£€æµ‹ç»§æ‰¿ <code>React.Component</code> çš„ç»„ä»¶å³å¯?</strong></p>
<p>å‰§é€: è¿™å°±æ˜¯Reactçš„å¤„ç†æ–¹å¼.</p>
<hr>
<p>ç°åœ¨æˆ‘ä»¬è¦æ£€æµ‹ <code>Greeting</code> æ˜¯å¦æ˜¯ä¸€ä¸ªReact ç±»ç»„ä»¶, æœ€ç¬¦åˆç›´è§‰çš„æ£€æµ‹æ–¹å¼æ˜¯ <code>Greeting.prototype instanceof React.Component</code> :</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(B.prototype <span class="keyword">instanceof</span> A); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ç†è§£ä»¥ä¸Šä»£ç çš„å«ä¹‰, æˆ‘ä»¬é¦–å…ˆè¦ç†è§£ JavaScript åŸå‹.  </p>
<p>å¤§å®¶å¯¹â€åŸå‹é“¾â€è¿™ä¸ªæ¦‚å¿µåº”è¯¥å·²ç»å¾ˆç†Ÿæ‚‰äº†. åœ¨JavaScriptä¸­, æ‰€æœ‰å¯¹è±¡å¯èƒ½å­˜åœ¨ä¸€ä¸ªâ€åŸå‹â€. å½“æˆ‘ä»¬æ‰§è¡Œè¿™æ®µä»£ç  <code>fred.sayHi()</code> æ—¶, <code>fred</code> è¿™ä¸ªå¯¹è±¡æœ¬èº«å¯èƒ½å¹¶ä¸å­˜åœ¨ <code>sayHi</code> å±æ€§. æˆ‘ä»¬ä¼šä» <code>fred</code> çš„åŸå‹ä¸Šå¯»æ‰¾è¿™ä¸ªå±æ€§. å¦‚æœæ²¡æœ‰æ‰¾åˆ°, åˆ™ä¼šå†æ·±å…¥åŸå‹é“¾å¯»æ‰¾ â€” <code>fred</code> çš„åŸå‹çš„åŸå‹. ç›´åˆ°æ‰¾åˆ°è¿™ä¸ªå±æ€§ä¸ºæ­¢.</p>
<p>ä½†æ¯”è¾ƒä»¤äººç–‘æƒ‘çš„ä¸€ç‚¹æ˜¯, ç±»æˆ–è€…å‡½æ•°çš„ <code>prototype</code> å±æ€§ä¸å®ƒçš„åŸå‹å¹¶ä¸å¯¹ç­‰.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype); <span class="comment">// ğŸ¤ª Not Person's prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.__proto__); <span class="comment">// ğŸ˜³ Person's prototype</span></span><br></pre></td></tr></table></figure>
<p>åŸå‹é“¾çš„ç»“æ„æ˜¯ <code>__proto__.__proto__.__proto__</code> è€Œä¸æ˜¯ <code>prototype.prototype.prototype</code> .</p>
<p>é‚£è¿™ä¸ª <code>prototype</code> å±æ€§æ˜¯ä»€ä¹ˆå‘¢?  å½“æˆ‘ä»¬ç”¨ <code>new</code> å®ä¾‹åŒ–ä¸€ä¸ªç±»æˆ–è€…å‡½æ•°æ—¶, å®ä¾‹çš„ <code>__proto__</code> å±æ€§å°±æ˜¯å°±æ˜¯ç±»æˆ–å‡½æ•°çš„ <code>prototype</code> å±æ€§.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">'Hi, I am '</span> + <span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fred = <span class="keyword">new</span> Person(<span class="string">'Fred'</span>); <span class="comment">// Sets `fred.__proto__` to `Person.prototype`</span></span><br></pre></td></tr></table></figure>
<p>JavaScriptä½¿ç”¨<strong><code>__proto__</code></strong> é“¾æŸ¥è¯¢å±æ€§:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fred.sayHi();</span><br><span class="line"><span class="comment">// 1. Does fred have a sayHi property? No.</span></span><br><span class="line"><span class="comment">// 2. Does fred.__proto__ have a sayHi property? Yes. Call it!</span></span><br><span class="line"></span><br><span class="line">fred.toString();</span><br><span class="line"><span class="comment">// 1. Does fred have a toString property? No.</span></span><br><span class="line"><span class="comment">// 2. Does fred.__proto__ have a toString property? No.</span></span><br><span class="line"><span class="comment">// 3. Does fred.__proto__.__proto__ have a toString property? Yes. Call it!</span></span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡åœ¨å®é™…åº”ç”¨ä¸­, ä½ ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ <code>__proto__</code> , é™¤éè°ƒè¯•æ—¶éœ€è¦æŸ¥è¯¢ä¸åŸå‹é“¾ç›¸å…³çš„ä¿¡æ¯. å¦‚æœä½ æƒ³ä½¿æŸäº›å±æ€§å¯ä»¥åˆ©ç”¨ <code>fred.__proto__</code> è®¿é—®, å°±åº”è¯¥å°†è¯¥ä¿¡æ¯æ”¾åœ¨ <code>Person.prototype</code> . è¿™ä¹Ÿæ˜¯ <code>prototype</code> è®¾è®¡çš„åˆè¡·.</p>
<p><code>__proto__</code> å±æ€§å…¶å®å¹¶ä¸åº”è¯¥æš´éœ²ç»™å¤–éƒ¨, å› ä¸ºå®ƒæœ¬è´¨ä¸Šåªç»™ JavaScript å†…éƒ¨ä½¿ç”¨. ä½†æ˜¯æŸäº›æµè§ˆå™¨ä¾ç„¶æ”¯æŒäº†è¯¥å±æ€§ç”šè‡³å°†å…¶æ ‡å‡†åŒ–(ä¸è¿‡å®ƒä¼šé€æ¸è¢« <code>Object.getPrototypeOf()</code> æ‰€æ›¿ä»£çš„.)</p>
<p><strong>ç°åœ¨æˆ‘ä¾ç„¶ç–‘æƒ‘çš„æ˜¯: å¯¹è±¡çš„ <code>prototype</code> å±æ€§å¯¹åº”çš„å€¼ç«Ÿç„¶ä¸æ˜¯å¯¹è±¡çš„åŸå‹</strong>(ä¸¾ä¸ªä¾‹å­: <code>fred.prototype</code> çš„å€¼ä¸º <code>undefined</code> , å› ä¸º <code>fred</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°). ä¸ªäººè®¤ä¸º, è¿™æ˜¯å¼€å‘è€…éš¾ä»¥ç†è§£ JavaScript åŸå‹æ¦‚å¿µçš„ä¸»è¦åŸå› .</p>
<hr>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†, å½“æˆ‘ä»¬è¾“å…¥ <code>obj.foo</code> æ—¶, JavaScript å®é™…ä¸Šä¼šåœ¨ <code>obj</code> <code>obj.__proto__</code>, <code>obj.__proto__.__proto__</code> â€¦ä¸Šå¯»æ‰¾ <code>foo</code> å±æ€§.</p>
<p>åœ¨ JavaScript ç±»ä¸­, å¹¶æ²¡æœ‰ç›´æ¥æš´éœ²è¿™ä¸ªæœºåˆ¶, ä¸è¿‡ <code>extends</code> çš„å®ç°åŸºäºè¿™ç§åŸå‹é“¾æœºåˆ¶. è¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„ React ç±»å®ä¾‹è¯»å– <code>setState</code> æ–¹æ³•æ‰€åˆ©ç”¨çš„æœºåˆ¶:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Greeting();</span><br><span class="line"><span class="built_in">console</span>.log(c.__proto__); <span class="comment">// Greeting.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(c.__proto__.__proto__); <span class="comment">// React.Component.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(c.__proto__.__proto__.__proto__); <span class="comment">// Object.prototype</span></span><br><span class="line"></span><br><span class="line">c.render();      <span class="comment">// Found on c.__proto__ (Greeting.prototype)</span></span><br><span class="line">c.setState();    <span class="comment">// Found on c.__proto__.__proto__ (React.Component.prototype)</span></span><br><span class="line">c.toString();    <span class="comment">// Found on c.__proto__.__proto__.__proto__ (Object.prototype)</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´, <strong>å½“æˆ‘ä»¬ä½¿ç”¨ç±»çš„æ—¶å€™, ç±»å®ä¾‹çš„ <code>__proto__</code> é“¾åæ˜ äº†è¿™ç§åŸå‹é“¾å…³ç³»:</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `extends` chain</span></span><br><span class="line">Greeting</span><br><span class="line">  â†’ React.Component</span><br><span class="line">    â†’ <span class="built_in">Object</span> (implicitly)</span><br><span class="line"></span><br><span class="line"><span class="comment">// `__proto__` chain</span></span><br><span class="line"><span class="keyword">new</span> Greeting()</span><br><span class="line">  â†’ Greeting.prototype</span><br><span class="line">    â†’ React.Component.prototype</span><br><span class="line">      â†’ <span class="built_in">Object</span>.prototype</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ—¢ç„¶äº†è§£äº† <code>__proto__</code> é“¾çš„æ¦‚å¿µ, æˆ‘ä»¬å°±èƒ½é€šè¿‡è¿™ç§æ–¹å¼æ£€æŸ¥ <code>Greeting</code> æ˜¯å¦ç»§æ‰¿è‡ª <code>React.Component</code> , ä» <code>Greeting.prototype</code> å¼€å§‹é€šè¿‡ <code>__proto__</code> ä¸æ–­å±‚å±‚æ·±å…¥.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `__proto__` chain</span></span><br><span class="line"><span class="keyword">new</span> Greeting()</span><br><span class="line">  â†’ Greeting.prototype <span class="comment">// ğŸ•µï¸ We start here</span></span><br><span class="line">    â†’ React.Component.prototype <span class="comment">// âœ… Found it!</span></span><br><span class="line">      â†’ <span class="built_in">Object</span>.prototype</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„æ–¹å¼, <code>x instanceof Y</code> ä¹Ÿå¯ä»¥å®ç°ä¸ä»¥ä¸Šä»£ç å‡ ä¹å·®ä¸å¤šçš„åŠŸèƒ½. è·Ÿç€ <code>x.__proro__</code> çš„åŸå‹é“¾å¯»æ‰¾ <code>Y.prototype</code> .</p>
<p>æ­£å¸¸æƒ…å†µä¸‹, æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹å¼æ¥åˆ¤æ–­ç±»çš„å®ä¾‹:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> greeting = <span class="keyword">new</span> Greeting();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(greeting <span class="keyword">instanceof</span> Greeting); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// greeting (ğŸ•µï¸â€ We start here)</span></span><br><span class="line"><span class="comment">//   .__proto__ â†’ Greeting.prototype (âœ… Found it!)</span></span><br><span class="line"><span class="comment">//     .__proto__ â†’ React.Component.prototype </span></span><br><span class="line"><span class="comment">//       .__proto__ â†’ Object.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(greeting <span class="keyword">instanceof</span> React.Component); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// greeting (ğŸ•µï¸â€ We start here)</span></span><br><span class="line"><span class="comment">//   .__proto__ â†’ Greeting.prototype</span></span><br><span class="line"><span class="comment">//     .__proto__ â†’ React.Component.prototype (âœ… Found it!)</span></span><br><span class="line"><span class="comment">//       .__proto__ â†’ Object.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(greeting <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// greeting (ğŸ•µï¸â€ We start here)</span></span><br><span class="line"><span class="comment">//   .__proto__ â†’ Greeting.prototype</span></span><br><span class="line"><span class="comment">//     .__proto__ â†’ React.Component.prototype</span></span><br><span class="line"><span class="comment">//       .__proto__ â†’ Object.prototype (âœ… Found it!)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(greeting <span class="keyword">instanceof</span> Banana); <span class="comment">// false</span></span><br><span class="line"><span class="comment">// greeting (ğŸ•µï¸â€ We start here)</span></span><br><span class="line"><span class="comment">//   .__proto__ â†’ Greeting.prototype</span></span><br><span class="line"><span class="comment">//     .__proto__ â†’ React.Component.prototype </span></span><br><span class="line"><span class="comment">//       .__proto__ â†’ Object.prototype (ğŸ™…â€ Did not find it!)</span></span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ä¹Ÿèƒ½ç”¨æ¥åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦ç»§æ‰¿è‡ªå¦ä¸€ä¸ªç±»:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(Greeting.prototype <span class="keyword">instanceof</span> React.Component);</span><br><span class="line"><span class="comment">// greeting</span></span><br><span class="line"><span class="comment">//   .__proto__ â†’ Greeting.prototype (ğŸ•µï¸â€ We start here)</span></span><br><span class="line"><span class="comment">//     .__proto__ â†’ React.Component.prototype (âœ… Found it!)</span></span><br><span class="line"><span class="comment">//       .__proto__ â†’ Object.prototype</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šè¿™ç§æ–¹å¼å¯ä»¥ç”¨ä»¥åŒºåˆ†React ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶.</p>
<hr>
<p>ä¸è¿‡Reactåœ¨ç”Ÿäº§ä¸­å¹¶ä¸æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼å»æ£€æŸ¥çš„. ğŸ˜³</p>
<p>ä½¿ç”¨ <code>instanceof</code> çš„åˆ¤æ–­æ–¹å¼æœ‰ä¸ªå¼Šç«¯, å½“æˆ‘ä»¬çš„é¡µé¢ä¸­å­˜åœ¨å¤šä¸ª React çš„æ‹·è´æ—¶,  æˆ‘ä»¬æ£€æŸ¥çš„æŸä¸ªç»„ä»¶å¯èƒ½ç»§æ‰¿è‡ªå¦ä¸€ä¸ª React æ‹·è´çš„ <code>React.Component</code> . åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å¤šä¸ª React æ‹·è´å½“ç„¶æ˜¯ä¸æ¨èçš„åšæ³•. ä½†æ˜¯ç”±äºå†å²åŸå› , æˆ‘ä»¬å¯èƒ½ä¼šç”¨å¤šä¸ª React æ‹·è´æ¥è§£å†³æŸäº›é—®é¢˜. (ä¸è¿‡å¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Hooks çš„è¯, <a href="https://github.com/facebook/react/issues/13991" target="_blank" rel="noopener">æˆ‘ä»¬å¯èƒ½å¿…é¡»è¦ç¦æ­¢å¤šä¸ªæ‹·è´çš„å­˜åœ¨</a>.)</p>
<p>å¦ä¸€ä¸ªåˆ¤æ–­æ–¹å¼æ˜¯, æ£€æŸ¥åŸå‹é“¾ä¸­çš„ <code>render</code> æ–¹æ³•æ˜¯å¦å­˜åœ¨. ç„¶è€Œ, å½“æ—¶å¯¹äº<a href="https://github.com/facebook/react/issues/4599#issuecomment-129714112" target="_blank" rel="noopener">ç»„ä»¶ç›¸å…³çš„ API è§„èŒƒå¹¶æ²¡æœ‰å®Œå…¨ç¡®å®šä¸‹æ¥.</a> éšæ—¶å¯èƒ½ä¼šå˜åŒ–. å¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼çš„è¯, Every check has a cost so we wouldnâ€™t want to add more than one. åŒæ—¶, å¦‚æœ <code>render</code> è¢«å®šä¹‰ä¸ºå®ä¾‹æ–¹æ³•çš„è¯, è¿™ç§æ–¹å¼ä¹Ÿä¼šå¤±æ•ˆ.</p>
<p>å› æ­¤ React é‡‡ç”¨äº†ä¸€ç§ç»™åŸºç¡€ç»„ä»¶<a href="https://github.com/facebook/react/pull/4663" target="_blank" rel="noopener">æ·»åŠ </a>ç‰¹æ®Šæ ‡å¿—çš„æ–¹å¼. React ä¼šæ£€æŸ¥è¿™ä¸ªæ ‡å¿—æ˜¯å¦å­˜åœ¨, é€šè¿‡è¿™ä¸ªæ ‡å¿—æ¥åˆ¤æ–­è¿™æ˜¯ä¸ªç±»ç»„ä»¶è¿˜æ˜¯å‡½æ•°ç»„ä»¶.</p>
<p>åœ¨æœ€åˆçš„å®ç°ç‰ˆæœ¬ä¸­, è¿™ä¸ªæ ‡å¿—å­˜åœ¨äº <code>React.Compoenent</code> æœ¬èº«:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line">Component.isReactClass = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We can check it like this</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Greeting.isReactClass); <span class="comment">// âœ… Yes</span></span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œ, ä¸€äº›ç±»åœ¨<a href="https://github.com/scala-js/scala-js/issues/1900" target="_blank" rel="noopener">å®ç°</a>ä¸Šå¹¶æ²¡æœ‰æ‹·è´é™æ€å±æ€§æˆ–è€…è®¾ç½®éæ ‡å‡†çš„ <code>__proto__</code> . åœ¨è¿™ç§æƒ…å†µä¸‹ React æ·»åŠ çš„ç‰¹æ®Šæ ‡å¿—å°±ä¸¢å¤±äº†.</p>
<p>äºæ˜¯Reactå›¢é˜Ÿ<a href="https://github.com/facebook/react/pull/5021" target="_blank" rel="noopener">å°†è¿™ä¸ªæ ‡å¿—è½¬ç§»</a>åˆ°äº† <code>React.Component.prototype</code> ä¸Šäº†:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inside React</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line">Component.prototype.isReactComponent = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We can check it like this</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Greeting.prototype.isReactComponent); <span class="comment">// âœ… Yes</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿè®¸å¾ˆå¤šäººä¼šç–‘æƒ‘, ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æ ‡è¯†ä¸æ˜¯å¸ƒå°”å€¼è€Œæ˜¯å¯¹è±¡. è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨ Jest è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•æ—¶, å‰å‡ ä¸ªç‰ˆæœ¬çš„ Jest é»˜è®¤æ‰“å¼€äº†<a href="https://dev.to/slashgear_/discover-jest-hidden-feature-automock-2c9f" target="_blank" rel="noopener">automocking</a>, ç”Ÿæˆçš„æ¨¡æ‹Ÿæµ‹è¯•æ•°æ®ä¼š<a href="https://github.com/facebook/react/pull/4663#issuecomment-136533373" target="_blank" rel="noopener">å¿½ç•¥åŸå§‹å€¼</a>, å› æ­¤å¦‚æœç”¨å¸ƒå°”å€¼çš„è¯, ä¼šå½±å“è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç»“æœ.</p>
<p><code>isReactComponent</code> çš„æ£€æµ‹æ–¹å¼è‡³ä»Šä¾ç„¶åœ¨<a href="https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L297-L300" target="_blank" rel="noopener">ä½¿ç”¨</a>. </p>
<p>å¦‚æœä½ åœ¨ç¼–å†™Reactç»„ä»¶çš„æ—¶å€™æ²¡æœ‰ç»§æ‰¿ <code>React.Component</code> . Reactå°±ä¸ä¼šåœ¨åŸå‹é“¾ä¸­æ‰¾åˆ° <code>isReactComponent</code> è¿™ä¸ªå±æ€§, ä¹Ÿä¸ä¼šå°†å…¶çœ‹åš class ç»„ä»¶. è¯»åˆ°è¿™é‡Œ, å¤§å®¶å¯èƒ½å°±éƒ½æ˜ç™½<a href="https://stackoverflow.com/questions/38481857/getting-cannot-call-a-class-as-a-function-in-my-react-project/42680526#42680526" target="_blank" rel="noopener">è¿™ä¸ªé—®é¢˜</a>çš„ç­”æ¡ˆäº†: å¦‚æœåœ¨Reactçš„å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ° <code>Cannot call a class as a function</code> çš„æŠ¥é”™, è®°å¾—åœ¨ä½¿ç”¨React ç±»ç»„ä»¶æ—¶åŠ ä¸Š <code>extends React.Component</code> . åŒæ—¶å¦‚æœä½ æ²¡æœ‰è¿™æ ·ä½¿ç”¨ç±»ç»„ä»¶, å´ç»„ä»¶å†…å´å®šä¹‰äº† <code>render</code> æ–¹æ³•, Reactä¹Ÿä¼šæŠ¥å‡ºä¸€ä¸ª<a href="https://github.com/facebook/react/pull/11168" target="_blank" rel="noopener">âš ï¸</a>. </p>
<hr>
<p>ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç‚¹æŒ‚ç¾Šå¤´å–ç‹—è‚‰ (<a href="https://en.wikipedia.org/wiki/Bait-and-switch" target="_blank" rel="noopener">bait-and-switch</a>) çš„æ„Ÿè§‰. <strong>å®é™…çš„è§£å†³æ–¹æ¡ˆé‚£ä¹ˆç®€å•, å¯æ˜¯æˆ‘ä»¬å´ä¸ç›´æ¥å›ç­”è¿™ä¸ªé—®é¢˜, è€Œæ˜¯é¥¶äº†é‚£ä¹ˆä¸€å¤§åœˆå»è§£é‡Šä¸ºä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆæ˜¯ä¸å¯è¡Œçš„.</strong> </p>
<p>åœ¨æˆ‘çš„ç»éªŒä¸­, åœ¨å®ç°ä¸€ä¸ªåº“çš„ API æ—¶, è¿™æ˜¯ç»å¸¸ä¼šé‡åˆ°çš„æƒ…å†µ. å¯¹äºä¸€ä¸ªä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿çš„ API, ä½ å¿…é¡»è¦æ·±å…¥è€ƒè™‘è¯­è¨€æœ¬èº«çš„è¯­ä¹‰, è¿è¡Œæ—¶çš„æ€§èƒ½, å­˜åœ¨/ä¸å­˜åœ¨ç¼–è¯‘æ­¥éª¤æ—¶çš„æ•ˆç‡, ç›¸å…³ç”Ÿæ€çš„å‘å±•ä»¥åŠæ‰“åŒ…æ–¹æ¡ˆ, æ—©æœŸçš„å‘Šè­¦ä»¥åŠå¾ˆå¤šå…¶ä»–é—®é¢˜. æœ€ç»ˆè®¾è®¡å‡ºæˆæœæˆ–è®¸ä¸ä¼šæ˜¯æœ€ä¼˜é›…çš„, ä½†æ˜¯è‚¯å®šæ˜¯æœ€å®ç”¨çš„.</p>
<p>å¦‚æœæœ€ç»ˆè®¾è®¡å‡ºæ¥çš„ API å¾ˆæˆåŠŸçš„è¯, é‚£ä¹ˆ API çš„ä½¿ç”¨è€…å°±å®Œå…¨ä¸éœ€è¦è€ƒè™‘å®ƒçš„è®¾è®¡è¿‡ç¨‹, åªéœ€è¦ä¸“æ³¨äºåˆ›å»ºåº”ç”¨å³å¯.</p>
<p>å¦‚æœä½¿ç”¨è€…å¯¹ API çš„è®¾è®¡æ„Ÿåˆ°å¥½å¥‡, äº†è§£å®ƒçš„åº•å±‚åŸç†å½“ç„¶æ˜¯å¾ˆå¥½çš„.</p>
</div></article></div></main><footer><div class="paginator"><a href="/posts/2020/01/22/how-does-setstate-know-what-to-do/" class="prev">PREV</a><a href="/posts/2019/06/27/element-in-view/" class="next">NEXT</a></div><div class="copyright"><p>Â© 2019 - 2023 <a href="https://icyfish.github.io/posts">Fish</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>
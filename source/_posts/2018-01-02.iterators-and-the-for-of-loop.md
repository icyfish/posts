---
title:  "Iterators ä¸ for-of å¾ªç¯"
date:   2018-01-02
permalink: iterators-and-the-for-of-loop
---

Iterators ä¸ for-of å¾ªç¯

<!-- more -->

## å¾ªç¯éå†æ•°ç»„çš„å‡ ç§æ–¹å¼

### forå¾ªç¯

```js
var myArray = [1, 2, 3]
for (var index = 0; index < myArray.length; index++) {
  console.log(myArray[index]);
}
```

### ES5 forEach

```js
var myArray = [1, 2, 3]
myArray.forEach(function (value) {
  console.log(value);
});
```

forEachçš„å†…éƒ¨å‡½æ•°**æ— æ³•ä½¿ç”¨ `break` æˆ– `return`**(?)

## for-in
 
```js
var myArray = [1, 2, 3]
for (var index in myArray) {  
  console.log(myArray[index]);
}
```

ç”¨`forâ€“in`å¾ªç¯éå†æ•°ç»„ä¸å¯å–: 

- indexæ˜¯å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å­—: `"0"`, `"1"`, `"2"`ç­‰

- æœ‰æ—¶å€™ä¸ä»¥æ­£å¸¸çš„é¡ºåºå¾ªç¯éå†

- æ— æ³•æ­£å¸¸éå†æŸäº›æ•°ç»„, å¦‚: 

```js
var a = [] 
a[5] = 3 

for (var i = 0; i < a.length; i++) {
    console.log(a[i]);
}
/* æ­£å¸¸forå¾ªç¯ç»“æœ:
   undefined
   undefined
   undefined
   undefined
   undefined
   3
*/
```

```js
var a = []
a[5] = 3
for (var x in a) {
    // å¿½ç•¥äº†æ•°ç»„å…ƒç´ ä¸­çš„å‰5ä¸ªå…ƒç´ , åªæœ‰3è¢«è¾“å‡º
    console.log(a[x])
}

/* for-inç»“æœ:
   3
*/
```

- æ•°ç»„ä¸­è‹¥æœ‰**å¯æšä¸¾å±æ€§(enumerable property)?**,ä¹Ÿä¼šè¢«éå†

```js
Array.prototype.foo = 1
var a = [1, 2, 3, 4, 5]
for (var x in a){
    console.log(x)
}
/* è¾“å‡º:
   0
   1
   2
   3
   4
   foo
*/
```


### for-of

- éå†æ•°ç»„æœ€ç®€å•ç›´æ¥çš„æ–¹å¼
- æ²¡æœ‰ `for-in`, `forEach`å­˜åœ¨çš„é‚£äº›ç¼ºé™·
- ä¸`for-in`çš„åŒºåˆ«:
  `for-in`å¾ªç¯éå†å¯¹è±¡å±æ€§
  `forâ€“of`å¾ªç¯éå†æ•°æ®(å¦‚æ•°ç»„ä¸­çš„å„ä¸ªå…ƒç´ )

- `for-of`è¿˜å¯ä»¥å¾ªç¯éå†å…¶å®ƒç±»å‹çš„é›†åˆ, å¦‚ç±»æ•°ç»„å¯¹è±¡: NodeLists, å­—ç¬¦ä¸²ç­‰:

```js
for (var chr of "ğŸ˜ºğŸ˜²") {
  console.log(chr)
}
```

- ä¹Ÿå¯ä»¥ç”¨äºéå†`Set`å’Œ`Map`å¯¹è±¡:

```js
var words = ['a', 'b', 'c']
var uniqueWords = new Set(words)
for(var word in uniqueWords){
  console.log(word)
}
```

  å¯¹äº`Map`å¯¹è±¡, éœ€è¦å…ˆè§£æ„å†éå†: 

```js
for (var [key, value] of phoneBookMap) {
  console.log(key + "'s phone number is: " + value);
}
```

- ä¸è¿‡`for-of`ä¸å¯ç›´æ¥ç”¨äºéå†ä¸€èˆ¬çš„å¯¹è±¡(plain object), å¦‚æœæƒ³è¦éå†è¿™ç§å¯¹è±¡çš„å±æ€§, åº”è¯¥å€ŸåŠ©`for-in`æˆ–è€…`Object.keys()`:

```js
var someObject = { 0: 'a', 1: 'b', 2: 'c', 'hello': 'world' };
for (var key of Object.keys(someObject)) {
  console.log(key + ": " + someObject[key]);
}
```

#### `for-of`çš„åŸç†

`for-of`é€šè¿‡è°ƒç”¨å¯¹è±¡æ–¹æ³•èµ·ä½œç”¨, `Array`, `Map`, `Set`ç­‰å¯éå†çš„å¯¹è±¡éƒ½æœ‰ä¸ªå…±åŒç‰¹ç‚¹, å®ƒä»¬æœ‰**éå†å™¨(iterator)**æ–¹æ³•. 

`for-of`æ— æ³•éå†ä¸€èˆ¬çš„å¯¹è±¡æ˜¯å› ä¸ºä¸€èˆ¬å¯¹è±¡çš„å±æ€§ä¸­æ²¡æœ‰éå†å™¨æ–¹æ³•, ä¸è¿‡æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åœ¨å¯¹è±¡åŸå‹ä¸­æ·»åŠ è¯¥æ–¹æ³•`myObject[Symbol.iterator]()`, å°±èƒ½å¤Ÿä½¿è¯¥å¯¹è±¡å¯ä»¥è¢«`for-of`å¾ªç¯éå†:

ä½¿ç”¨`forâ€“of`å¾ªç¯éå†å¯¹è±¡, é¦–å…ˆè°ƒç”¨äº†`[Symbol.iterator]()`æ–¹æ³•, è°ƒç”¨åçš„ç»“æœæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å¯éå†çš„å¯¹è±¡, è¿™ä¸ªå¯¹è±¡çš„å±æ€§ä¸­æœ‰ä¸ª`next()`æ–¹æ³•, `for-of`åœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•. ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å¯éå†å¯¹è±¡çš„ä¾‹å­:

```js
var zeroesForeverIterator = {
  [Symbol.iterator]: function () {
    return this;
  },
  next: function () {
    return {done: false, value: 0};
  }
}
```

å¯¹äºä»¥ä¸Šçš„å¯¹è±¡, æ¯æ¬¡`next()`è¢«è°ƒç”¨, éƒ½ä¼šè¿”å›åŒæ ·çš„ç»“æœ, å‘Šè¯‰`for-of`å¾ªç¯: 1).éå†è¿˜æœªç»“æŸ; 2). ä¸‹ä¸€ä¸ªå€¼æ˜¯0. 
æ­¤æ—¶,` for (value of zeroesForeverIterator) {}`å°±æ˜¯ä¸ªæ— é™å¾ªç¯.

å«æœ‰éå†å™¨æ–¹æ³•çš„å¯¹è±¡è¿˜å®ç°äº†å¯é€‰çš„`.return()`æ–¹æ³•å’Œ`.throw(exc)`æ–¹æ³•. å¦‚æœå¾ªç¯ç”±äºæŠ›å‡ºå¼‚å¸¸æˆ–`break`æˆ–`return`å£°æ˜è¿‡æ—©é€€å‡º, `for-of`ä¼šè°ƒç”¨`.return()`. ä¸è¿‡å¤§éƒ¨åˆ†æƒ…å†µä¸‹, ä¸éœ€è¦ç”¨åˆ°`.return()`æ–¹æ³•, `.throw(exc)`æ›´ç‰¹æ®Š, `for-of`ä»ä¸è°ƒç”¨è¯¥æ–¹æ³•. (more about it?)

```js
for (VAR of ITERABLE) {
  STATEMENTS
}
```

ä»¥ä¸Š`for-of`å¾ªç¯, å®é™…ä¸Šæ‰§è¡Œçš„æ“ä½œæ˜¯(ç®€å•ç‰ˆæœ¬): 

```js
var $iterator = ITERABLE[Symbol.iterator]();
var $result = $iterator.next();
while (!$result.done) {
  VAR = $result.value;
  STATEMENTS
  $result = $iterator.next();
}
```

ä»¥ä¸Šåªæ˜¯ç®€å•çš„ç‰ˆæœ¬, å¤§è‡´ä½“ç°äº†`for-of`æ˜¯å¦‚ä½•å®ç°çš„, å®é™…ä¸Šæ›´å¤æ‚, ä½†å¯¹äºç†è§£ä¸Šå¹¶æ²¡æœ‰å¤ªå¤§çš„å¸®åŠ©, å› æ­¤çœç•¥æŸäº›æ–¹æ³•çš„å®ç°(ä¾‹å¦‚æ˜¯å¦‚ä½•å¤„ç†`return()`çš„). `for-of`å¾ˆå¥½ç”¨, ä½†æ˜¯åº•å±‚çš„å®ç°æ¯”è¾ƒå¤æ‚.

#### ä½¿ç”¨`for-of`

æˆªè‡³åŸæ–‡å®Œæˆçš„æ—¶é—´**(2015-04-29)**, æŸäº›æµè§ˆå™¨è¿˜ä¸æ”¯æŒ`for-of`, åœ¨Chromeä¸­, å¯æ‰“å¼€`chrome://flags`æ‰¾åˆ°â€œExperimental JavaScriptâ€å¹¶è¿›è¡Œå¯ç”¨. åœ¨æœåŠ¡ç«¯æƒ³è¦ä½¿ç”¨è¯¥ç‰¹æ€§, åœ¨æ‰§è¡ŒNodeæŒ‡ä»¤æ—¶åŠ ä¸Š`--harmony`é€‰é¡¹. 

## Resources

- [Iterators and the for-of loop](https://hacks.mozilla.org/2015/04/es6-in-depth-iterators-and-the-for-of-loop/)


Next articles will be: 

- [Generators](https://hacks.mozilla.org/2015/05/es6-in-depth-generators/) in [ES6 In Depth](https://hacks.mozilla.org/author/jorendorffmozillacom/page/2/).

- CSS Modules 

Questions In This Article: `cmd + f` + `?`
















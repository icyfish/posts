<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="IDYUPnBNhdnU8o9LRNKZ1RSt14tIxTI0rLeMrBtswXw"><title> 对象与函数 · Fish</title><meta name="description" content="对象与函数 - Fish"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/posts/favicon.png"><link rel="stylesheet" href="/posts/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://icyfish.github.io/posts/atom.xml" title="Fish"><meta name="generator" content="Hexo 7.0.0-rc1"></head><body><div class="wrap"><header><a href="/posts/" class="logo-link"><img src="/posts/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/posts/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/posts/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/posts/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="http://twitter.com/icyfish_" target="_blank" class="nav-list-link">TWITTER</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">对象与函数</h1><div class="post-info">Oct 28, 2016</div><div class="post-content"><p>在JavaScript中, 一切皆对象, 函数也是特殊的对象.</p>
<a id="more"></a>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>在JavaScript中, <strong>对象</strong> 是名值对的集合, 值可以由多个名值对组成. 名值对是互相关联的一对名和值 Name/Value Pair. 名可以被定义多次,但在特定的 <strong>执行环境</strong> 中只能匹配一个值.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Address:</span><br><span class="line">&#123;</span><br><span class="line">  Street: <span class="string">'Main'</span>,</span><br><span class="line">  <span class="built_in">Number</span>: <span class="number">100</span>,</span><br><span class="line">  Apartment:</span><br><span class="line">  &#123;</span><br><span class="line">    Floor: <span class="number">3</span>,</span><br><span class="line">    <span class="built_in">Number</span>: <span class="number">301</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对象的属性"><a href="#对象的属性" class="headerlink" title="对象的属性"></a>对象的属性</h3><p>对象及其属性(将属性和方法统称为属性, 下同)都存在于内存空间, 对象可以获取到与其相关联的属性(have a reference to them, 即获取到的是指向属性所在内存空间的地址).</p>
<p><img src="/posts/images/object-in-memory.jpg" alt="Object in memory"></p>
<p>有两种操作符可以获取属性值:</p>
<ol>
<li><code>object[&quot;property&quot;]</code>: 括号(Computed Member Access Operator)</li>
<li><code>object.property</code>: 点号(Member Access Operator)</li>
</ol>
<p>多用点号操作符, 因为更简洁也更利于调试.</p>
<h3 id="对象字面量-Object-Literals"><a href="#对象字面量-Object-Literals" class="headerlink" title="对象字面量(Object Literals)"></a>对象字面量(Object Literals)</h3><p><code>var person = {}</code>: 用对象字面量方法创建对象.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  firstname: <span class="string">'John'</span>,</span><br><span class="line">  lastname: <span class="string">'Doe'</span>,</span><br><span class="line">  address: &#123;</span><br><span class="line">    street: <span class="string">'111 Main St.'</span>,</span><br><span class="line">    city: <span class="string">'New York'</span>,</span><br><span class="line">    state: <span class="string">'NY'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">person.firstname = <span class="string">'John'</span>;</span><br><span class="line">person.lastname = <span class="string">'Doe'</span>;</span><br></pre></td></tr></table></figure>
<p>两种方法中, 对象字面量创建对象的方法更好, 比<code>new</code>更简洁, 用处更大. 比如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> john = &#123;</span><br><span class="line">  firstname: <span class="string">'John'</span>,</span><br><span class="line">  lastname: <span class="string">'Doe'</span>,</span><br><span class="line">  address: &#123;</span><br><span class="line">    street: <span class="string">'111 Main St.'</span>,</span><br><span class="line">    city: <span class="string">'New York'</span>,</span><br><span class="line">    state: <span class="string">'NY'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">person</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hi '</span> + person.firstname);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet(john);</span><br><span class="line"></span><br><span class="line">greet(&#123;</span><br><span class="line">  firstname: <span class="string">'Jane'</span>,</span><br><span class="line">  lastname: <span class="string">'Doe'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以直接传入对象作为参数</span></span><br></pre></td></tr></table></figure>
<p>尽管语法不一致, 实际的原理是一样的, 都是在内存空间中创建对象及属性.</p>
<h3 id="JSON与对象字面量"><a href="#JSON与对象字面量" class="headerlink" title="JSON与对象字面量"></a>JSON与对象字面量</h3><p>过去传输数据常用XML格式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">firstname</span>&gt;</span>Mary<span class="tag">&lt;/<span class="name">firstname</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">isAProgrammer</span>&gt;</span>true<span class="tag">&lt;/<span class="name">isAProgrammer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但因为XML格式包含太多额外的标记, 在传输过程中会浪费很多带宽, JSON的出现解决了这样的问题.<br>JSON实际上是对象字面量语法的一个子集. 并不属于JavaScript, 但因为格式和JS对象十分相似, 所以JavaScript解析JSON格式的数据十分容易. JavaScript中内置了<code>JSON.stringify()</code>将JS对象转化为JSON, <code>JSON.parse()</code>将JSON解析为JS对象.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"firstname"</span>: <span class="string">"Mary"</span>,</span><br><span class="line">  <span class="attr">"isAProgrammer"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="函数也是对象"><a href="#函数也是对象" class="headerlink" title="函数也是对象"></a>函数也是对象</h2><p><strong>JavaScript中, 函数是一等公民</strong></p>
<p>任何其他数据类型可以做的事, 函数也能做到, 如:</p>
<ul>
<li>将函数赋给变量</li>
<li>作为参数传递给其他函数</li>
<li>可以被即时创建</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  a();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">log(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hi'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>函数也是对象, 因此可以为函数关联属性. 其中两个比较特别的属性是函数名和代码. 而函数名并不是必要的, 不存在函数名的函数是匿名函数. 我们所写的那段代码实际上是函数作为对象的其中一个属性, 并不是函数本身, 同时这个属性是可以被调用的.</p>
<p><img src="/posts/images/function=object.jpg" alt="functions-are-objects"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hi'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 给函数(对象)greet关联language属性</span></span><br><span class="line">greet.language = <span class="string">'English'</span>;  </span><br><span class="line"><span class="built_in">console</span>.log(greet.language);</span><br></pre></td></tr></table></figure>
<p><img src="/posts/images/func-example.jpg" alt="function-example"></p>
<p>当函数greet被创建时, 该函数被置于内存空间, 在上述情况下, 该函数是全局对象的属性.</p>
<h2 id="函数声明与函数表达式"><a href="#函数声明与函数表达式" class="headerlink" title="函数声明与函数表达式"></a>函数声明与函数表达式</h2><p><strong>表达式(expression):</strong> 会返回值, 可以将其储存在一个变量中, 但并非必要.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="number">1</span> + <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">a = &#123;<span class="attr">greeting</span>: <span class="string">'hi'</span>&#125;;</span><br><span class="line"><span class="comment">// Object &#123;greeting: "hi"&#125;;</span></span><br></pre></td></tr></table></figure>
<p>以上三者都为表达式, 因为都返回了值, 表达式返回的可以是任何类型的值.</p>
<p><strong>声明(statement):</strong> 不会返回值.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a === <span class="number">3</span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码中<code>a === 3</code>是表达式, 返回布尔值, if语句是声明.</p>
<p><strong>函数声明:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">greet();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hi'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>函数声明直到执行时才返回值, 在执行环境的创建阶段(creation phase)被置于内存空间, 即被提升(<strong>hoisting</strong>), 因此在声明之前的位置可以调用函数.</p>
<p><strong>函数表达式:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">anonymousGreet(); <span class="comment">// 不可以在这里调用</span></span><br><span class="line"><span class="keyword">var</span> anonymousGreet = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hi'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// anonymousGreet();</span></span><br><span class="line"><span class="comment">//在这里调用才能够执行</span></span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>函数表达式不会被提升(<strong>no hoisting</strong>), 因为事先置于内存空间的是<code>var anonymousGreet;</code>, 因此上述代码会抛出错误.</p>
<h2 id="值-by-value-与引用-by-reference"><a href="#值-by-value-与引用-by-reference" class="headerlink" title="值(by value)与引用(by reference)"></a>值(by value)与引用(by reference)</h2><p><strong>变量(原始类型)通过值传递</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by value</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"></span><br><span class="line">b = a;</span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p><img src="/posts/images/by-value.jpg" alt="pass by value"></p>
<ol>
<li>将某个原始类型值(primitive value)赋值给变量a, 此时a就指向了那个值在内存空间所在的地址;</li>
<li><code>b = a</code>: 变量b指向一个新的内存空间地址, 那个地址所存储的值是a变量所指向值的拷贝, 因此b的值为3;</li>
<li>因为存储在不同的地址, 因此之后再改变a的值不会影响到b的值.</li>
</ol>
<p><strong>变量(对象)通过引用传递</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &#123;<span class="attr">greeting</span>: <span class="string">'hi'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> d;</span><br><span class="line"></span><br><span class="line">d = c;</span><br><span class="line">c.greeting = <span class="string">'hello'</span>; <span class="comment">// mutate</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// Object &#123;greeting: 'hello'&#125;;</span></span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// Object &#123;greeting: 'hello'&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeGreeting</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  obj.greeting = <span class="string">'Hola'</span>; <span class="comment">// mutate</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">changeGreeting(d);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// Object &#123;greeting: 'Hola'&#125;;</span></span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// Object &#123;greeting: 'Hola'&#125;;</span></span><br><span class="line"></span><br><span class="line">c = &#123; <span class="attr">greeting</span>: <span class="string">'howdy'</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c); <span class="comment">// Object &#123;greeting: 'howdy'&#125;;</span></span><br><span class="line"><span class="built_in">console</span>.log(d); <span class="comment">// Object &#123;greeting: 'Hola'&#125;;</span></span><br></pre></td></tr></table></figure>
<p><img src="/posts/images/by-ref.jpg" alt="pass by ref"></p>
<ol>
<li>将对象(包括函数)赋值给变量a时, a指向对象在内存空间所在地址;</li>
<li><code>b = a</code>: 变量b不会指向新的内存空间地址, 而是指向a所指向的地址, 没有新的对象被创建;</li>
<li>因此改变a和b的值都会影响到对方.</li>
<li><code>changeGreeting(d);</code>通过传入函数的方式改变d的行为同样也会影响到c.</li>
<li>所有对象都是通过引用传递.</li>
<li><code>c = { greeting: &#39;howdy&#39;};</code> 赋值操作符会在内存空间创建一个新地址, 此时c就不再指向原地址, 而d的指向不变, 因此出现c和d值不同的情况.</li>
</ol>
<h2 id="参数-arguments"><a href="#参数-arguments" class="headerlink" title="参数(arguments)"></a>参数(arguments)</h2><p><img src="/posts/images/args.jpg" alt="arguments"></p>
<p>当函数的执行环境被创建时, JS引擎除了创建变量环境(container for variables), <code>this</code>, 外部环境(for reference), 还创建了另一个特殊的变量<code>arguments</code>.<br><code>arguments</code>是所有参数值的集合, 是类数组元素, 并非数组.</p>
<p><strong>设置参数默认值:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">firstname, lastname, language</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(firstname);</span><br><span class="line">  <span class="built_in">console</span>.log(lastname);</span><br><span class="line">  <span class="built_in">console</span>.log(language);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet();</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>尽管greet函数在定义时有三个参数, 但还是可以不传递任何参数调用greet函数, 这是JavaScript的特性, 在大多数编程语言中不可以这样调用, 由于变量声明提升(Hoisting), 结果出现三个undefined, 但这不是我们想要的结果, 可是实际过程中不传递参数直接调用函数的情况很可能出现, 可以通过以下方法避免出现undefined的情况.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">firstname, lastname, language</span>)</span>&#123;</span><br><span class="line"><span class="comment">// 1. 为参数设定默认值</span></span><br><span class="line">  language = language || <span class="string">'en'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 通过arguments变量获取参数数量</span></span><br><span class="line"><span class="comment">//    如果没有参数, 在控制台中提示</span></span><br><span class="line"><span class="comment">//    并直接返回, 中断函数的执行</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">arguments</span>.length === <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Missing parameters'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(firstname);</span><br><span class="line">  <span class="built_in">console</span>.log(lastname);</span><br><span class="line">  <span class="built_in">console</span>.log(language);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet(); <span class="comment">// "Missing parameters"</span></span><br><span class="line">greet(<span class="string">'John'</span>, <span class="string">'Doe'</span>);</span><br><span class="line"><span class="comment">// John</span></span><br><span class="line"><span class="comment">// Doe</span></span><br><span class="line"><span class="comment">// en</span></span><br><span class="line"><span class="comment">// ["John", "Doe"]</span></span><br><span class="line">greet(<span class="string">'John'</span>, <span class="string">'Doe'</span>, <span class="string">'es'</span>);</span><br><span class="line"><span class="comment">// John</span></span><br><span class="line"><span class="comment">// Doe</span></span><br><span class="line"><span class="comment">// es</span></span><br><span class="line"><span class="comment">// ["John", "Doe", "es"]</span></span><br></pre></td></tr></table></figure>
<p>在ES6中可以这样设定默认值:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">firstname=<span class="string">'John'</span>, lastname=<span class="string">'Doe'</span>, language=<span class="string">'en'</span></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(firstname);</span><br><span class="line">  <span class="built_in">console</span>.log(lastname);</span><br><span class="line">  <span class="built_in">console</span>.log(language);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet();</span><br><span class="line"><span class="comment">// John</span></span><br><span class="line"><span class="comment">// Doe</span></span><br><span class="line"><span class="comment">// en</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<h2 id="‘this’"><a href="#‘this’" class="headerlink" title="‘this’"></a>‘this’</h2><p><code>this</code>的值取决于函数是如何被调用的.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &#123;</span><br><span class="line">  name: <span class="string">'The c object'</span>,</span><br><span class="line">  log: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'Updated c object'</span>;<span class="comment">// 这里的this执行对象c, 因此this.name改变的是对象c的name属性</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// Object &#123;name: "Updated c object"&#125;</span></span><br><span class="line">    <span class="keyword">var</span> setname = <span class="function"><span class="keyword">function</span>(<span class="params">newname</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = newname;</span><br><span class="line">      <span class="comment">// console.log(this); // Window</span></span><br><span class="line">    &#125;</span><br><span class="line">    setname(<span class="string">'Updated again'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">// Object &#123;name: "Updated c object"&#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// c.log();</span></span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// "Updated again"</span></span><br></pre></td></tr></table></figure>
<p>对于上述代码的第二个<code>console.log(this);</code>, 因为在对象c内定义了函数表达式setname, 并在内改变了name的值, 因此预期输出的是<code>Object {name: &quot;Updated again&quot;}</code>, 但实际上并非如此, 通过在setname函数中输出this值发现, 这个this指向全局对象(浏览器中是Window), 因此setname实际上是在全局环境中定义了name变量, 在全局环境输出name可以发现这里的name值才是”Updated again”.</p>
<p>为了避免发生这样的错误, 可以预先定义this的值:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &#123;</span><br><span class="line">  name: <span class="string">'The c object'</span>,</span><br><span class="line">  log: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    self.name = <span class="string">'Updated c object'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(self); <span class="comment">// Object &#123;name: "Updated c object"&#125;</span></span><br><span class="line">    <span class="keyword">var</span> setname = <span class="function"><span class="keyword">function</span>(<span class="params">newname</span>)</span>&#123;</span><br><span class="line">      self.name = newname;</span><br><span class="line">    &#125;</span><br><span class="line">    setname(<span class="string">'Updated again'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(self); <span class="comment">// Object &#123;name: "Updated again"&#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">c.log();</span><br></pre></td></tr></table></figure>
<p>因为对象通过引用传递, self与this一样指向对象c, 可以通过self改变对象的属性. 在setname函数中, 没有声明self的值, 通过作用域链到外部寻找self变量, 于是找到了在log方法内定义的指向对象c的self.</p>
<hr>
<p><strong>参考</strong></p>
<ul>
<li><a href="https://www.udemy.com/understand-javascript/" target="_blank" rel="noopener">JavaScript: Understanding the Weird Parts</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/posts/2016/10/30/io/" class="prev">PREV</a><a href="/posts/2016/10/25/types-and-operators/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2023 <a href="https://icyfish.github.io/posts">Fish</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>